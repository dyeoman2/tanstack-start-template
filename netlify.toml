[build]
  command = "echo 'üèóÔ∏è Starting build process...' && echo 'üöÄ Deploying Convex functions and building application...' && npx convex deploy --cmd 'pnpm build' && echo 'üéâ Build completed successfully'"
  publish = "dist/client"

[build.environment]
  NODE_VERSION = "24"
  SECRETS_SCAN_OMIT_KEYS = "VITE_CONVEX_SITE_URL"

# Deploy previews skip Convex deployment (use preview deployment instead)
[context.deploy-preview]
  command = "echo 'üèóÔ∏è Building preview (skipping Convex deploy)...' && pnpm build && echo 'üéâ Preview build completed successfully'"

[template]
  full = true

[[template.environment]]
name = "BETTER_AUTH_SECRET"
required = true
default = ""
description = "32-byte base64 secret for JWT signing and rate limiting. Generate with: openssl rand -base64 32. Must match the secret used in Convex. Example: 'abc123def456ghi789jkl012mno345pqr678stu901vwx='"

[[template.environment]]
name = "CONVEX_DEPLOY_KEY"
required = true
default = ""
description = "Production deploy key from Convex Dashboard. To get this: 1) Go to https://dashboard.convex.dev, 2) Select your project, 3) Go to Settings ‚Üí Deploy Keys, 4) Click 'Generate Production Deploy Key', 5) Copy the key (starts with 'prod:'). Required for deploying Convex functions during Netlify build."

[[template.environment]]
name = "CONVEX_URL"
required = true
default = ""
description = "Your Convex deployment URL. Run 'npx convex env get CONVEX_URL --prod' to get this value. Example: https://abc-123.convex.cloud"

[[template.environment]]
name = "VITE_CONVEX_SITE_URL"
required = true
default = ""
description = "Convex site URL for client-side connections. Run 'npx convex env get VITE_CONVEX_SITE_URL --prod' to get this value. Example: https://abc-123.convex.site"

[[template.environment]]
name = "VITE_CONVEX_URL"
required = true
default = ""
description = "Same as CONVEX_URL but for client-side use. Run 'npx convex env get VITE_CONVEX_URL --prod' to get this value. Example: https://abc-123.convex.cloud"

[[template.environment]]
name = "APP_NAME"
required = false
default = "TanStack Start Template"
description = "Application name used in email templates and branding. Defaults to 'TanStack Start Template'."
